<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/whatareyoutryingtodo/disable-devtool.min.js" disable-devtool-auto=""></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Horror Tale</title>
    <link rel="stylesheet" href="TemplateData/style.css" />

    <!-- Stub out Yandex SDK / platform so the game doesn't crash -->
    <script>
  (function () {
    const global = window;

    // Base object (reuse if something already exists)
    const sdk = global.sdk || {};
    const ysdk = global.ysdk || sdk;

    // ---- deviceInfo stub (fixes `.type` error in _GetCurrentPlatform) ----
    const deviceInfo =
      sdk.deviceInfo ||
      ysdk.deviceInfo || {
        type: "desktop",
        isMobile: function () {
          return false;
        },
        isTablet: function () {
          return false;
        },
        isDesktop: function () {
          return true;
        },
        isTV: function () {
          return false;
        },
      };

    deviceInfo.type = deviceInfo.type || "desktop";
    deviceInfo.isMobile =
      deviceInfo.isMobile ||
      function () {
        return false;
      };
    deviceInfo.isTablet =
      deviceInfo.isTablet ||
      function () {
        return false;
      };
    deviceInfo.isDesktop =
      deviceInfo.isDesktop ||
      function () {
        return true;
      };
    deviceInfo.isTV =
      deviceInfo.isTV ||
      function () {
        return false;
      };

    // ---- environment stub ----
    const environment =
      sdk.environment ||
      ysdk.environment || {
        i18n: {
          lang: "en",
          tld: "com",
        },
        browser: {
          lang: navigator.language || "en-US",
        },
        app: {
          id: "stub-app-id",
        },
      };

    // ---- feedback / rating stubs (for _CanRateUs & similar) ----
    const feedback = sdk.feedback || ysdk.feedback || {};

    feedback.canReview =
      feedback.canReview ||
      function () {
        console.log("[stub] sdk.feedback.canReview called – disabled.");
        return Promise.resolve({
          value: false,
          reason: "disabled",
        });
      };

    feedback.requestReview =
      feedback.requestReview ||
      function () {
        console.log(
          "[stub] sdk.feedback.requestReview called – pretending no review."
        );
        return Promise.resolve({
          feedbackSent: false,
        });
      };

    // Some builds call sdk.canReview / sdk.rateUs directly
    sdk.canReview =
      sdk.canReview ||
      function () {
        console.log("[stub] sdk.canReview called – disabled.");
        return Promise.resolve({
          value: false,
          reason: "disabled",
        });
      };

    sdk.rateUs =
      sdk.rateUs ||
      function () {
        console.log("[stub] sdk.rateUs called – no-op.");
        return Promise.resolve({
          feedbackSent: false,
        });
      };

    // ---- ADV (ads) stub (fixes `showFullscreenAdv` in _ShowInterstitional) ----
    const adv = sdk.adv || ysdk.adv || {};

    adv.showFullscreenAdv =
      adv.showFullscreenAdv ||
      function (options) {
        console.log("[stub] sdk.adv.showFullscreenAdv called", options);

        const cbs = options && options.callbacks ? options.callbacks : {};

        // Simulate an ad opening and closing successfully, but with no actual ad
        try {
          cbs.onOpen && cbs.onOpen();
        } catch (e) {
          console.warn("[stub] onOpen callback error", e);
        }

        try {
          // false = ad not actually shown / or just indicate quick close
          cbs.onClose && cbs.onClose(false);
        } catch (e) {
          console.warn("[stub] onClose callback error", e);
        }

        // No error, no offline. Just resolve.
        return Promise.resolve();
      };

    // (Optional) rewarded videos, in case the build uses them:
    adv.showRewardedVideo =
      adv.showRewardedVideo ||
      function (options) {
        console.log("[stub] sdk.adv.showRewardedVideo called", options);
        const cbs = options && options.callbacks ? options.callbacks : {};

        try {
          cbs.onOpen && cbs.onOpen();
        } catch (e) {
          console.warn("[stub] rewarded onOpen callback error", e);
        }

        try {
          // Don't actually grant rewards; just close gracefully.
          cbs.onClose && cbs.onClose(false);
        } catch (e) {
          console.warn("[stub] rewarded onClose callback error", e);
        }

        return Promise.resolve();
      };

    // ---- AUTH stub (fixes `openAuthDialog` in _Auth) ----
    const auth = sdk.auth || ysdk.auth || {};

    auth.openAuthDialog =
      auth.openAuthDialog ||
      function () {
        console.log("[stub] ysdk.auth.openAuthDialog called – pretending user cancelled.");
        // In the real SDK, this resolves with a player object or rejects on cancel.
        // We'll just pretend the user cancelled login so the game can fallback.
        return Promise.reject({ code: "AUTH_CANCEL" });
      };

    // ---- player stub (for _CheckAuthenticated and similar) ----
    let player = global.player || {
      getMode: function () {
        // "lite", "full", etc. We'll just pretend "lite".
        return "lite";
      },
      getUniqueID: function () {
        console.log("[stub] player.getUniqueID called");
        return Promise.resolve("stub-uid");
      },
      getName: function () {
        console.log("[stub] player.getName called");
        return Promise.resolve("Guest");
      },
      getPhoto: function () {
        console.log("[stub] player.getPhoto called");
        return Promise.resolve(null);
      },
      getPayingStatus: function () {
        console.log("[stub] player.getPayingStatus called");
        return Promise.resolve("unknown");
      },
      getSignature: function () {
        console.log("[stub] player.getSignature called");
        return Promise.resolve("stub-signature");
      },
    };

    global.player = player;

    // ---- getPlayer stub (some games call ysdk.getPlayer() after auth) ----
    sdk.getPlayer =
      sdk.getPlayer ||
      function () {
        console.log("[stub] sdk.getPlayer called");
        return Promise.resolve(player);
      };

    // Attach everything back on sdk and ysdk
    sdk.deviceInfo = deviceInfo;
    sdk.environment = environment;
    sdk.feedback = feedback;
    sdk.adv = adv;
    sdk.auth = auth;

    global.sdk = sdk;

    if (!global.ysdk) {
      global.ysdk = sdk;
    } else {
      // if ysdk already exists, attach bits to it too
      global.ysdk.deviceInfo = global.ysdk.deviceInfo || deviceInfo;
      global.ysdk.environment = global.ysdk.environment || environment;
      global.ysdk.feedback = global.ysdk.feedback || feedback;
      global.ysdk.adv = global.ysdk.adv || adv;
      global.ysdk.auth = global.ysdk.auth || auth;
      global.ysdk.getPlayer = global.ysdk.getPlayer || sdk.getPlayer;
    }
  })();
</script>


    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: #000;
      }

      #unity-container {
        width: 100%;
        height: 100%;
      }

      #unity-canvas {
        width: 100%;
        height: 100%;
        background: #000;
      }

      #unity-loading-bar {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      #unity-progress-bar-empty {
        width: 200px;
        height: 20px;
        border: 1px solid #fff;
        margin-top: 10px;
      }

      #unity-progress-bar-full {
        width: 0%;
        height: 100%;
        background: #fff;
      }
    </style>

    <!-- ✨ Intro styles (only intro-related additions) -->
    <style>
      #intro-screen {
        position: fixed;
        inset: 0;
        background-color: #414141;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.7s ease, visibility 0.7s ease;
      }

      #intro-screen.hidden-intro {
        opacity: 0;
        visibility: hidden;
      }

      #intro-logo-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: fadeIn 1s ease-out forwards;
      }

      #intro-title {
        font-family: "Orbitron", system-ui, -apple-system, BlinkMacSystemFont,
          sans-serif;
        font-size: 42px;
        font-weight: 700;
        letter-spacing: 3px;
        margin-bottom: 20px;
        background: linear-gradient(90deg, #d3a410, #b7870f, #ffe4a1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 8px rgba(211, 165, 16, 0.4));
        opacity: 0;
        animation: titleFade 1s ease forwards 0.4s;
        text-align: center;
      }

      @keyframes titleFade {
        from {
          opacity: 0;
          transform: translateY(-12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes bounce {
        0%,
        100% {
          translate: 0px 36px;
        }
        50% {
          translate: 0px 46px;
        }
      }
      @keyframes bounce2 {
        0%,
        100% {
          translate: 0px 46px;
        }
        50% {
          translate: 0px 56px;
        }
      }
      @keyframes umbral {
        0% {
          stop-color: #d3a5102e;
        }
        50% {
          stop-color: rgba(211, 165, 16, 0.519);
        }
        100% {
          stop-color: #d3a5102e;
        }
      }
      @keyframes particles {
        0%,
        100% {
          translate: 0px 16px;
        }
        50% {
          translate: 0px 6px;
        }
      }

      #particles {
        animation: particles 4s ease-in-out infinite;
      }
      #animatedStop {
        animation: umbral 4s infinite;
      }
      #bounce {
        animation: bounce 4s ease-in-out infinite;
        translate: 0px 36px;
      }
      #bounce2 {
        animation: bounce2 4s ease-in-out infinite;
        translate: 0px 46px;
        animation-delay: 0.5s;
      }
    </style>
  </head>

  <body>
    <!-- ✨ Intro overlay (only new markup) -->
    <div id="intro-screen">
      <div id="intro-logo-wrapper">
        <div id="intro-title">Tinkle Games</div>

        <svg xmlns="http://www.w3.org/2000/svg" height="200" width="200">
          <g style="order: -1;">
            <polygon
              transform="rotate(45 100 100)"
              stroke-width="1"
              stroke="#d3a410"
              fill="none"
              points="70,70 148,50 130,130 50,150"
              id="bounce"
            ></polygon>
            <polygon
              transform="rotate(45 100 100)"
              stroke-width="1"
              stroke="#d3a410"
              fill="none"
              points="70,70 148,50 130,130 50,150"
              id="bounce2"
            ></polygon>
            <polygon
              transform="rotate(45 100 100)"
              stroke-width="2"
              stroke=""
              fill="#414750"
              points="70,70 150,50 130,130 50,150"
            ></polygon>
            <polygon
              stroke-width="2"
              stroke=""
              fill="url(#gradiente)"
              points="100,70 150,100 100,130 50,100"
            ></polygon>
            <defs>
              <linearGradient
                y2="100%"
                x2="10%"
                y1="0%"
                x1="0%"
                id="gradiente"
              >
                <stop
                  style="stop-color: #1e2026;stop-opacity:1"
                  offset="20%"
                ></stop>
                <stop
                  style="stop-color:#414750;stop-opacity:1"
                  offset="60%"
                ></stop>
              </linearGradient>
            </defs>
            <polygon
              transform="translate(20, 31)"
              stroke-width="2"
              stroke=""
              fill="#b7870f"
              points="80,50 80,75 80,99 40,75"
            ></polygon>
            <polygon
              transform="translate(20, 31)"
              stroke-width="2"
              stroke=""
              fill="url(#gradiente2)"
              points="40,-40 80,-40 80,99 40,75"
            ></polygon>
            <defs>
              <linearGradient
                y2="100%"
                x2="0%"
                y1="-17%"
                x1="10%"
                id="gradiente2"
              >
                <stop
                  style="stop-color: #d3a51000;stop-opacity:1"
                  offset="20%"
                ></stop>
                <stop
                  style="stop-color:#d3a51054;stop-opacity:1"
                  offset="100%"
                  id="animatedStop"
                ></stop>
              </linearGradient>
            </defs>
            <polygon
              transform="rotate(180 100 100) translate(20, 20)"
              stroke-width="2"
              stroke=""
              fill="#d3a410"
              points="80,50 80,75 80,99 40,75"
            ></polygon>
            <polygon
              transform="rotate(0 100 100) translate(60, 20)"
              stroke-width="2"
              stroke=""
              fill="url(#gradiente3)"
              points="40,-40 80,-40 80,85 40,110.2"
            ></polygon>
            <defs>
              <linearGradient
                y2="100%"
                x2="10%"
                y1="0%"
                x1="0%"
                id="gradiente3"
              >
                <stop
                  style="stop-color: #d3a51000;stop-opacity:1"
                  offset="20%"
                ></stop>
                <stop
                  style="stop-color:#d3a51054;stop-opacity:1"
                  offset="100%"
                ></stop>
              </linearGradient>
            </defs>
            <polygon
              transform="rotate(45 100 100) translate(80, 95)"
              stroke-width="2"
              stroke=""
              fill="#ffe4a1"
              points="5,0 5,5 0,5 0,0"
              id="particles"
            ></polygon>
            <polygon
              transform="rotate(45 100 100) translate(80, 55)"
              stroke-width="2"
              stroke=""
              fill="#ccb069"
              points="6,0 6,6 0,6 0,0"
              id="particles"
            ></polygon>
            <polygon
              transform="rotate(45 100 100) translate(70, 80)"
              stroke-width="2"
              stroke=""
              fill="#fff"
              points="2,0 2,2 0,2 0,0"
              id="particles"
            ></polygon>
            <polygon
              stroke-width="2"
              stroke=""
              fill="#292d34"
              points="29.5,99.8 100,142 100,172 29.5,130"
            ></polygon>
            <polygon
              transform="translate(50, 92)"
              stroke-width="2"
              stroke=""
              fill="#1f2127"
              points="50,50 120.5,8 120.5,35 50,80"
            ></polygon>
          </g>
        </svg>
      </div>
    </div>

    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
    </div>

    <script>
      // Create a stub global gameInstance with a safe SendMessage
      // so any early JS->Unity calls don't crash.
      window.gameInstance =
        window.gameInstance ||
        {
          SendMessage: function (obj, method, value) {
            console.log(
              "[stub] gameInstance.SendMessage before init:",
              obj,
              method,
              value
            );
          },
        };

      // Keep a reference for convenience (same object as window.gameInstance)
      var gameInstance = window.gameInstance;

      const buildUrl = "Build";
      const loaderUrl = buildUrl + "/HT1_web.loader.js";

      const config = {
        dataUrl: buildUrl + "/HT1_web.data.unityweb",
        frameworkUrl: buildUrl + "/HT1_web.framework.js.unityweb",
        codeUrl: buildUrl + "/HT1_web.wasm.unityweb",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Horror Tale",
        productName: "Horror Tale",
        productVersion: "1.0",
      };

      const canvas = document.querySelector("#unity-canvas");
      const loadingBar = document.querySelector("#unity-loading-bar");
      const progressBarFull = document.querySelector(
        "#unity-progress-bar-full"
      );

      loadingBar.style.display = "block";

      const script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        })
          .then((instance) => {
            // Copy all properties onto the existing stub object so any
            // references to `gameInstance` keep working.
            Object.assign(gameInstance, instance);
            loadingBar.style.display = "none";
          })
          .catch((message) => {
            console.error(message);
          });
      };

      document.body.appendChild(script);
    </script>

    <!-- ✨ Intro hide script (only for intro) -->
    <script>
      window.addEventListener("load", () => {
        const intro = document.getElementById("intro-screen");
        if (!intro) return;
        setTimeout(() => {
          intro.classList.add("hidden-intro");
          setTimeout(() => intro.remove(), 800);
        }, 2500);
      });
    </script>
  </body>
</html>
